
## 事务（transaction）

事务四大特性（ACID），原子性（atomicity)、一致性（consistency）、隔离性（isolation）、持久性（durability）

### 原子性（atomicity)

一个事务**要么全部提交成功，要么全部失败回滚，**不能只执行其中的一部分操作，这就是事务的原子性。

### 一致性（consistency）

事务的执行**不能破坏数据库数据的完整性和一致性**，一个事务在执行之前和执行之后，数据库都必须处于一致性状态。

如果数据库系统在运行过程中发生故障，有些事务尚未完成就被迫中断，这些未完成的事务对数据库所作的修改有一部分已写入物理数据库，这是数据库就处于一种不正确的状态，也就是不一致的状态。

### 隔离性（isolation）

事务的隔离性是指在并发环境中，并发的事务时**相互隔离**的，一个事务的执行不能不被其他事务干扰。

不同的事务并发操作相同的数据时，每个事务都有各自完成的数据空间，即一个事务内部的操作及使用的数据对其他并发事务时隔离的，并发执行的各个事务之间不能相互干扰。


#### 事务隔离级别

在标准SQL规范中，定义了 4 个事务隔离级别，不同的隔离级别对事务的处理不同，分别是**未授权读取，授权读取，可重复读取和串行化**

- 未提交（Read Uncommited）
- 授权读取也称为已提交读（Read Commited）
- 可重复读（Repeatable Read)
- 串行化


### 持久性（durability）

一旦事务提交，那么它对数据库中的对应数据的状态的变更就会**永久保存**到数据库中。--即使发生系统崩溃或机器宕机等故障，只要数据库能够重新启动，那么一定能够将其恢复到事务成功结束的状态。



### 事务的并发问题

- 脏读

事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据

- 不可重复读（针对单条数据）

事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。

- 幻读（针对多条数据）

系统管理员 A 将数据库中所有学生的成绩从具体分数改为 ABCDE 等级，但是系统管理员 B 就在这个时候插入了一条具体分数的记录，
当系统管理员 A 改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（read-uncommitted） | 是   | 是         | 是   |
| 不可重复读（read-committed） | 否   | 是         | 是   |
| 可重复读（repeatable-read）  | 否   | 否         | 是   |
| 串行化（serializable）       | 否   | 否         | 否   |
